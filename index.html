<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bio World Wide Web — Living Chaos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#020204}
canvas{display:block}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
/* =========================
   CANVAS
========================= */
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let w,h;
function resize(){w=canvas.width=innerWidth;h=canvas.height=innerHeight}
addEventListener('resize',resize);resize();

/* =========================
   TIME
========================= */
let age=0, phase=0;

/* =========================
   CLIMATE — OPENWEATHERMAP
========================= */
const climate={
  temp:300,
  humidity:0.7,
  pressure:1013,
  windSpeed:1,
  windDeg:0,
  rain:0
};

async function loadClimate(){
  try{
    const res = await fetch(
      "https://api.openweathermap.org/data/2.5/weather?lat=-6.9147&lon=107.6098&appid=89f1147fa055db1474a1cc119d0ba7ce"
    );
    const d = await res.json();

    climate.temp = d.main.temp;
    climate.humidity = d.main.humidity/100;
    climate.pressure = d.main.pressure;
    climate.windSpeed = d.wind.speed || 0;
    climate.windDeg = d.wind.deg || 0;
    climate.rain = d.rain ? (d.rain["1h"]||0) : 0;
  }catch(e){
    console.warn("Climate fallback");
  }
}
loadClimate();
setInterval(loadClimate,10*60*1000);

/* =========================
   AUDIO
========================= */
const A = new (AudioContext||webkitAudioContext)();
const master=A.createGain();
master.gain.value=0.35;
master.connect(A.destination);

function noiseNode(){
  const b=A.createBuffer(1,A.sampleRate*2,A.sampleRate);
  const d=b.getChannelData(0);
  for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
  const s=A.createBufferSource();
  s.buffer=b; s.loop=true;
  return s;
}

const voices=[];
for(let i=0;i<16;i++){
  const o=A.createOscillator();
  const n=noiseNode();
  const f=A.createBiquadFilter();
  const g=A.createGain();
  o.type='sawtooth';
  o.frequency.value=30+i*18;
  f.type='bandpass';
  g.gain.value=0;
  o.connect(f); n.connect(f);
  f.connect(g).connect(master);
  o.start(); n.start();
  voices.push({o,f,g,seed:Math.random()*10});
}

/* =========================
   FIELD
========================= */
const scale=14;
let cols,rows,angle=[],dens=[];
function buildField(){
  cols=(w/scale)|0; rows=(h/scale)|0;
  angle=[...Array(cols)].map(()=>Array(rows).fill(0));
  dens=[...Array(cols)].map(()=>Array(rows).fill(0));
}
buildField();

function updateField(t){
  const windAng = climate.windDeg*Math.PI/180;
  const wind = climate.windSpeed*0.25;
  for(let x=0;x<cols;x++){
    for(let y=0;y<rows;y++){
      const nx=x*0.16, ny=y*0.16;
      const a =
        Math.sin(nx+t*0.00035)+
        Math.cos(ny-t*0.0003);
      const n=Math.sin(nx*ny*0.025+t*0.00025);
      angle[x][y]=a+n*3 + Math.cos(windAng)*wind;
      dens[x][y]=Math.abs(n)*(0.4+climate.humidity);
    }
  }
}

/* =========================
   NODES
========================= */
class Node{
  constructor(){
    this.x=Math.random()*w;
    this.y=Math.random()*h;
    this.trail=Array.from({length:16},()=>({x:this.x,y:this.y}));
    this.vx=0; this.vy=0;
    this.h=Math.random()*360;
  }
  move(){
    const ix=(this.x/scale)|0, iy=(this.y/scale)|0;
    const a=(angle[ix]&&angle[ix][iy])||0;
    const d=(dens[ix]&&dens[ix][iy])||0;
    this.vx+=Math.cos(a)*(0.08+d*0.3);
    this.vy+=Math.sin(a)*(0.08+d*0.3);
    this.vx*=0.92; this.vy*=0.92;
    this.x=(this.x+this.vx+w)%w;
    this.y=(this.y+this.vy+h)%h;
    this.trail.pop();
    this.trail.unshift({x:this.x,y:this.y});
  }
}
let nodes=[...Array(520)].map(()=>new Node());

/* =========================
   SPIKES
========================= */
const spikes=[];
function nearestNode(x,y){
  let m=1e9,t=null;
  for(const n of nodes){
    const dx=n.x-x,dy=n.y-y;
    const d=dx*dx+dy*dy;
    if(d<m){m=d;t=n}
  }
  return t;
}
function createSpike(){
  const n=nodes[Math.random()*nodes.length|0];
  const s={head:{x:n.x,y:n.y,vx:0,vy:0},fibers:[],target:null,life:1200};
  for(let f=0;f<40;f++){
    const pts=[];
    for(let i=0;i<16;i++) pts.push({x:s.head.x,y:s.head.y});
    s.fibers.push({pts,stick:0.2,drift:Math.random()*10});
  }
  spikes.push(s);
}
for(let i=0;i<6;i++) createSpike();

/* =========================
   LOOP
========================= */
function loop(t){
  age+=0.00002;
  ctx.fillStyle='rgba(2,2,4,0.04)';
  ctx.fillRect(0,0,w,h);

  updateField(t);
  nodes.forEach(n=>n.move());

  spikes.forEach(s=>{
    if(!s.target||Math.random()<0.004) s.target=nearestNode(s.head.x,s.head.y);
    if(s.target){
      const dx=s.target.x-s.head.x;
      const dy=s.target.y-s.head.y;
      s.head.vx+=dx*0.0015*(1+climate.windSpeed*0.3);
      s.head.vy+=dy*0.0015;
    }
    s.head.vx*=0.9; s.head.vy*=0.9;
    s.head.x+=s.head.vx;
    s.head.y+=s.head.vy;

    s.fibers.forEach(f=>{
      const pts=f.pts;
      pts[0].x+=(s.head.x-pts[0].x)*0.4;
      pts[0].y+=(s.head.y-pts[0].y)*0.4;
      for(let i=1;i<pts.length;i++){
        pts[i].x+=(pts[i-1].x-pts[i].x)*f.stick;
        pts[i].y+=(pts[i-1].y-pts[i].y)*f.stick;
      }
      ctx.beginPath();
      pts.forEach(p=>ctx.lineTo(p.x,p.y));
      ctx.strokeStyle=`hsla(${90+climate.temp%60},90%,60%,0.05)`;
      ctx.lineWidth=0.5;
      ctx.stroke();
    });
  });

  nodes.forEach(n=>{
    ctx.beginPath();
    n.trail.forEach((p,i)=>{
      if(i===0)ctx.moveTo(p.x,p.y);
      else ctx.lineTo(p.x,p.y);
    });
    ctx.strokeStyle=`hsla(${n.h},90%,70%,0.12)`;
    ctx.stroke();
  });

  const chaos=Math.min(spikes.length/6+climate.windSpeed,2);
  voices.forEach((v,i)=>{
    v.o.frequency.setTargetAtTime(
      40+i*20+chaos*600,
      A.currentTime,0.15
    );
    v.g.gain.setTargetAtTime(
      chaos*0.025,
      A.currentTime,0.2
    );
  });

  ctx.fillStyle='rgba(180,220,255,0.45)';
  ctx.font='12px monospace';
  ctx.fillText(
    `BIO WWW — Bandung Climate | Temp ${(climate.temp-273).toFixed(1)}°C | Hum ${(climate.humidity*100).toFixed(0)}%`,
    12,h-14
  );

  requestAnimationFrame(loop);
}

document.body.onclick=()=>A.resume();
loop(0);
</script>
</body>
</html>
